<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <title>Document</title>
    <style>
        body {
    font-family: 'urbanist', sans-serif;
    background-color: #f0f4f8;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

.container {
    background-color: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    width: 400px;
    text-align: center;
}

h1 {
    color: #333;
    margin-bottom: 20px;
}

form div {
    margin-bottom: 15px;
    text-align: left;
}

label {
    font-weight: 500;
    margin-bottom: 5px;
    display: block;
}

input[type="url"],
input[type="text"] {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
}

button {
    background-color: #4a90e2;
    color: #fff;
    padding: 14px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #357ac9;
}

h2 {
    color: #555;
    margin-top: 30px;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    background-color: #fafafa;
    margin: 10px 0;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

li a {
    color: #4a90e2;
    text-decoration: none;
    font-weight: 500;
}

li a:hover {
    text-decoration: underline;
}
    </style>
</head>

<body>
    <div class="container">
        <h1>URL Shortener</h1>
        <form id="shorten-form">
            <div>
                <label for="url">Enter URL:</label>
                <input type="url" name="url" id="url" required>
            </div>
            <div>
                <label for="shortCode">Enter shortCode:</label>
                <input type="text" name="shortCode" id="shortCode" required>
            </div>
            <button type="submit">Shorten</button>
        </form>

        <h2>Shortened URLs</h2>
        <ul id="shortened-urls"></ul>
    </div>

    <script>


        const fetchShortenedURL = async () => {
            const response = await fetch("/links");
            const links = await response.json();
            console.log("links ", links);

            const list = document.getElementById("shortened-urls");
            list.innerHTML = "";

            for (const [shortCode, url] of Object.entries(links)) {
                const li = document.createElement('li');
                const truncatedURL = url.length >= 30 ? `${url.slice(0, 30)}...` : url;
                li.innerHTML = `<a href="/${shortCode}" target="_blank">${window.location.origin}/${shortCode}</a> - ${truncatedURL}`
                list.appendChild(li)
            }
        }

        document.getElementById('shorten-form')
            .addEventListener('submit', async (event) => {
                event.preventDefault();

                const formData = new FormData(event.target);
                const url = formData.get('url');
                const shortCode = formData.get('shortCode')

                console.log(url, shortCode);

                try {
                    const response = await fetch("/shorten", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ url, shortCode })
                    });

                    if (response.ok) {
                        fetchShortenedURL();
                        alert("fomr submitted successfully");
                        event.target.reset();
                    } else {
                        const errorMessage = await response.text();
                        alert(errorMessage)
                    }

                } catch (error) {
                    console.log(error);

                }
            })

        fetchShortenedURL();
    </script>
</body>

</html>